public class ChiffreAffaireCalculator
{
    public static void calculateChiffreAffaire(List<Account> accounts)
    {
        Map<Id, Decimal> accountIdToTotalAmountMap = new Map<Id, Decimal>();
​
        for (Order orderRecord : [SELECT AccountId, TotalAmount FROM Order WHERE AccountId IN :accounts WITH SECURITY_ENFORCED]) {
            if (accountIdToTotalAmountMap.containsKey(orderRecord.AccountId))
            {
                accountIdToTotalAmountMap.put(orderRecord.AccountId, accountIdToTotalAmountMap.get(orderRecord.AccountId) + orderRecord.TotalAmount);
            }
            else
            {
                accountIdToTotalAmountMap.put(orderRecord.AccountId, orderRecord.TotalAmount);
            }
        }
​
        List<Account> accountsToUpdate = new List<Account>();
​
        for (Account myAccount : accounts) {
            if (accountIdToTotalAmountMap.containsKey(myAccount.Id))
            {
                myAccount.Chiffre_d_affaire__c = accountIdToTotalAmountMap.get(myAccount.Id);
            }
            else
            {
                myAccount.Chiffre_d_affaire__c = 0;
            }
            accountsToUpdate.add(myAccount);
        }
​
        if (!accountsToUpdate.isEmpty())
        {
            update accountsToUpdate;
        }
    }
}